<!DOCTYPE html>
<html class="no-js">
  <head>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>ruby中String和symbol的区别</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

<!-- CSS -->
<link rel="stylesheet" href="/css/owl.carousel.css" />
<link rel="stylesheet" href="/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/font-awesome.min.css" />
<link rel="stylesheet" href="/css/airspace.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/ionicons.min.css" />
<link rel="stylesheet" href="/css/animate.css" />
<link rel="stylesheet" href="/css/responsive.css" />
<link rel="stylesheet" href="/css/syntax.css" />

<!-- Js -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/plugins.js"></script>
<script src="/js/min/waypoints.min.js"></script>
<script src="/js/jquery.counterup.js"></script>


<script src="/js/main.js"></script>

<!--
/*
 * Airspace
 * Ported to Jekyll by Andrew Lee
 * https://github.com/luminousrubyist/airspace-jekyll
 * Designed and Developed by ThemeFisher
 * https://themefisher.com/
 *
 */
-->


  </head>
  <body>


    <!-- Header Start -->
<header>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <!-- header Nav Start -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html" >
              <img src="/img/logo.png" alt="Logo" style="width: 70px">
            </a>
          </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="/">主页</a></li>
                <!--<li><a href="/work">Work</a></li>-->
                <li><a href="/blog">博客</a></li>
                <!--<li><a href="#">Service</a></li>-->
                <li><a href="/contact">联系我</a></li>
              </ul>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
    </div>
  </div>
</header><!-- header close -->



    <div class="post">
  <!-- Wrapper Start -->
  <section id="intro" style="border: 1px dotted #ddd;">
    <div class="container">
      <div class="row">
        <div>
          <div class="block">
            <h1>ruby中String和symbol的区别</h1>
            <div class="post-info-wrapper">
              <p class="italic">By <span class="bold">meedesidy</span> on <span class="bold">July 13, 2017</span></p>
            </div>
            <hr />
            <p><h2 id="ruby中string和symbol的区别">ruby中String和symbol的区别</h2>
<h3 id="symbol">Symbol</h3>
<ul>
  <li>定义：Ruby 是一个强大的面向对象脚本语言（本文所用 Ruby 版本为1.8.6），在 Ruby 中 Symbol 表示“名字”，比如字符串的名字，标识符的名字。</li>
  <li>创建：创建一个 Symbol 对象的方法是在名字或者字符串前面加上冒号：
    <pre><code class="language-irb">  irb(main):001:0&gt; :foo
  =&gt; :foo
  irb(main):002:0&gt; :test
  =&gt; :test
  irb(main):004:0&gt; :"foo is string"
  =&gt; :"foo is string"
</code></pre>
    <h3 id="string">String</h3>
  </li>
  <li>定义：Ruby 中的 String 对象用于存储或操作一个或多个字节的序列。</li>
  <li>创建：Ruby 字符串分为单引号字符串（’）和双引号字符串（”），区别在于双引号字符串能够支持更多的转义字符。
    <pre><code class="language-irb">  irb(main):007:0&gt; "这是一个字符串"
  =&gt; "这是一个字符串"
  irb(main):008:0&gt; '这也是一个字符串'
  =&gt; "这也是一个字符串"

</code></pre>
    <h3 id="区别">区别</h3>
  </li>
  <li>因为在 Ruby 中字符串也是一种对象，即 String 对象。无论其结构还是操作和 Symbol 对象都是不同的。</li>
  <li>
    <p>在 Ruby 中每一个对象都有唯一的对象标识符（Object Identifier）,可以通过 object_id 方法来得到一个对象的标识符</p>

    <ul>
      <li>Symbol</li>
    </ul>

    <pre><code class="language-irb">  irb(main):009:0&gt; :foo.object_id
  =&gt; 1149148
  irb(main):010:0&gt; :foo.object_id
  =&gt; 1149148
  irb(main):011:0&gt; :"foo".object_id
  =&gt; 1149148

</code></pre>

    <ul>
      <li>String</li>
    </ul>

    <pre><code class="language-irb">  irb(main):014:0* "foo".object_id
  =&gt; 47353958516800
  irb(main):015:0&gt; "foo".object_id
  =&gt; 47353958510640
  irb(main):016:0&gt; "foo".object_id
  =&gt; 47353958500960

</code></pre>

    <ul>
      <li>从上面可以看出，　前三句都是同一个Symble对象，后三个都是不同的String对象</li>
      <li>
        <p>可见，每个 String 对象都是不同的，即便他们包含了相同的字符串内容；而对于 Symbol 对象，一个名字（字符串内容）<strong>唯一确定</strong> 一个 Symbol 对象。</p>
      </li>
      <li><em>值得注意的是创建 Symbol 对象的字符串中不能含有’\0’字符，而 String 对象是可以的。</em>
        <pre><code class="language-irb">  irb(main):001:0&gt;  :"fo\0o"
  SyntaxError: compile error
  (irb):1: symbol cannot contain '\0'
       from (irb):1
  irb(main):002:0&gt; :"foo\0"
  SyntaxError: compile error
  (irb):2: symbol cannot contain '\0'
       from (irb):2
  irb(main):003:0&gt; puts "foo\0".object_id
  24305140
  =&gt; nil
  irb(main):004:0&gt; puts "fo\0o".object_id
  24301000
  =&gt; nil
  irb(main):005:0&gt;
</code></pre>
      </li>
      <li>经过实际测试发现并不是这样(可能是因为ruby版本不一致，测试版本为 2.3.1)</li>
    </ul>

    <pre><code class="language-irb"> irb(main):002:0&gt; :"fo\0o"
 =&gt; :"fo\x00o"
 irb(main):003:0&gt; :"foo\0"
 =&gt; :"foo\x00"
 irb(main):004:0&gt; puts "foo\0".object_id
 47315761608520
</code></pre>
  </li>
  <li>除了可以采用一般的字符串，还可以使用操作符（例如+, -, *, /），变量，常量，方法甚至类的名字来创建 Symbol 对象，例如:+就是一个合法的 Symbol 。实际上，在 Ruby 内部操作符、变量等名字本身就是作为 Symbol 处理的，例如当你定义一个实例变量时， Ruby 会自动创建一个 Symbol 对象，例如 @test 对应为 :@test 。
    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code>  <span class="c1"># 实例变量的 Symbol</span>

  <span class="k">class</span> <span class="nc">Test</span>
   <span class="kp">attr_accessor</span> <span class="ss">:test</span>
  <span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>这个类定义了一个具有读写方法的实例变量 @test 。实际上 Ruby 创建了两个 Symbol ，一个是实例变量的 symbol :@test ，另一个是 :test 。那如果使用字符串对象 ”test” 作为参数呢？也可以，仍然会创建两个 symbol ，:test 和 :@test ，为什么还会创建 :test 呢？这是和Ruby的实现相关的（至少Ruby1.8.6里是这样）。</p>
  </li>
  <li>
    <p>注意，<strong>类变量 @@test 和实例变量 @test 对应的 Symbol 显然是不同的。记住：名字相同，则Symbol 相同</strong>。 名字相同， Symbol 相同</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">Test</span>
    <span class="nb">puts</span> <span class="ss">:Test</span><span class="p">.</span><span class="nf">object_id</span>
    <span class="no">Test</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="nb">puts</span> <span class="ss">:Test</span><span class="p">.</span><span class="nf">object_id</span>

    <span class="k">def</span> <span class="nf">Test</span>
      <span class="nb">puts</span> <span class="ss">:Test</span><span class="p">.</span><span class="nf">object_id</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="no">Test</span><span class="p">.</span><span class="nf">new</span><span class="o">.</span><span class="no">Test</span>
</code></pre>
    </div>
    <p>运行结果</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code>  <span class="mi">224298</span>
  <span class="mi">224298</span>
  <span class="mi">224298</span>
</code></pre>
    </div>
  </li>
  <li>名字不同， Symbol 不同
    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">Test</span>
    <span class="nb">puts</span> <span class="ss">:Test</span><span class="p">.</span><span class="nf">object_id</span>

    <span class="vc">@@test</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="nb">puts</span> <span class="ss">:@@test</span><span class="p">.</span><span class="nf">object_id</span>
    <span class="k">def</span> <span class="nf">test</span>
      <span class="nb">puts</span> <span class="ss">:test</span><span class="p">.</span><span class="nf">object_id</span>
      <span class="vi">@test</span> <span class="o">=</span> <span class="mi">10</span>
      <span class="nb">puts</span> <span class="ss">:@test</span><span class="p">.</span><span class="nf">object_id</span>

    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">t</span> <span class="o">=</span><span class="no">Test</span><span class="p">.</span><span class="nf">new</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">test</span>
</code></pre>
    </div>
    <p>运行结果</p>
    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="mi">224298</span>
<span class="mi">288068</span>
<span class="mi">79858</span>
<span class="mi">288108</span>
</code></pre>
    </div>
  </li>
  <li><strong>Symbol 表示一个名字，仅此而已</strong></li>
  <li>
    <p><strong>Symbol 对象一旦定义将一直存在，直到程序执行退出</strong></p>

    <blockquote>
      <p>可以通过类方法 Symbol.all_symbols 得到当前 Ruby 程序中定义的所有 Symbol 对象，该方法返回一个 Symbol 对象数组</p>
    </blockquote>
  </li>
</ul>

<h3 id="string-和symbol">String 和　Symbol</h3>
<ul>
  <li>String 类有很多方法，Symbol类只有all_symbols()的类方法和７个实例方法</li>
  <li>虽然 Symbol 和 String 是不同的对象，但它们之间关系很密切。 Ruby 提供了方法在 Symbol和 String 之间转换。</li>
</ul>

<h4 id="symbol-转化为-string">Symbol 转化为 String</h4>
<ul>
  <li>Symbol 到 String
    <pre><code class="language-irb">  irb(main):001:0&gt; :test.id2name
  =&gt; "test"
  irb(main):002:0&gt; :test.to_s
  =&gt; "test"
  irb(main):003:0&gt; :"I am a boy".to_s
  =&gt; "I am a boy"
</code></pre>
  </li>
  <li><strong>注意，每个 String 对象都是唯一的，因此对一个 Symbol 调用多次将产生多个 String 对象。</strong></li>
</ul>

<h4 id="string-转化为-symbol">String 转化为 Symbol</h4>
<p>如果该 Symbol 已经存在，则直接返回。</p>
<ul>
  <li>String 到 Symbol
    <pre><code class="language-irb">irb(main):001:0&gt; var1 = "test".to_sym
=&gt; :test
irb(main):002:0&gt; var2 = "test".intern
=&gt; :test
irb(main):003:0&gt; var1 == var2
=&gt; true
</code></pre>
  </li>
</ul>

<h3 id="使用-symbol">使用 Symbol</h3>
<ul>
  <li>Symbol本质上是 Ruby 符号表中的东西, 使用Symbol可以降低ruby内存消耗，提高执行速度</li>
  <li>
    <p>通常来讲，当你面临 String 还是 Symbol 的选择时，可以参考以下标准：</p>

    <blockquote>
      <ul>
        <li>如果使用字符串的内容，这个内容可能会变化，使用 String</li>
        <li>如果使用固定的名字或者说是标识符，使用 Symbol,比如枚举值、关键字（哈希表关键字、方法的参数）
          <h4 id="hash中使用">Hash中使用</h4>
        </li>
      </ul>
    </blockquote>
  </li>
  <li>使用 Symbol 作为 key
    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code>  <span class="n">hosts</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">:beijing</span> <span class="o">=&gt;</span> <span class="s1">'machine1'</span><span class="p">,</span>
      <span class="ss">:shanghai</span> <span class="o">=&gt;</span> <span class="s1">'machine2'</span><span class="p">,</span>
      <span class="ss">:guangzhou</span> <span class="o">=&gt;</span> <span class="s1">'machine3'</span><span class="p">,</span>
      <span class="ss">:tianjin</span><span class="s1">' =&gt; '</span><span class="n">machine4</span><span class="s1">',
      :shenzhen =&gt; '</span><span class="n">machine5</span><span class="err">'</span>
      <span class="p">}</span>
</code></pre>
    </div>
  </li>
  <li>使用　String 作为 key
    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code>   <span class="n">hosts</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">"beijing"</span> <span class="o">=&gt;</span> <span class="s1">'machine1'</span><span class="p">,</span>
      <span class="s2">"shanghai"</span> <span class="o">=&gt;</span> <span class="s1">'machine2'</span><span class="p">,</span>
      <span class="ss">:guangzhou</span><span class="s2">" =&gt; 'machine3',
      "</span><span class="n">tianjin</span><span class="s2">" =&gt; 'machine4',
      "</span><span class="n">shenzhen</span><span class="s2">" =&gt; 'machine5'
      }
</span></code></pre>
    </div>
  </li>
  <li><strong>每次获取hosts值的时候使用hosts[:beijing],不会创建新的对象。</strong></li>
  <li><strong>每次获取hosts值的时候使用hosts[“beijing”],每次都会创建新的String对象，造成多余的内存和性能开销</strong></li>
</ul>

<h3 id="哈希参数">哈希参数</h3>
<ul>
  <li>通常我们定义的函数的参数的个数和顺序是写死的，调用函数的时候要确保参数的个数、顺序匹配，有时候这样很不方便，使用哈希参数可以解决这个问题。</li>
  <li>ROR 中就大量地运用这种方式，也许你已经看到了，到处都是 Symbol 和哈希</li>
</ul>

<p>使用哈希参数的方法调用
    <code class="highlighter-rouge">ruby
    link_to 'Show', :action =&gt; 'show', :id =&gt; product
    add_column :products, :price, :decimal, :precision =&gt; 8, :scale =&gt; 2, :default =&gt; 0
   </code></p>
</p>
          </div>
        </div><!-- .col-md-7 close -->
      </div>
    </div>
  </section>
</div>
<p class="center-text" style="padding: 30px;">
  <a href="/blog">Back to blog</a>
</p>











    <!-- footer Start -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="footer-manu">
          <ul>
            <li><a href="#">About Us</a></li>
            <li><a href="/contact">Contact us</a></li>
            <li><a href="#">How it works</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="#">Terms</a></li>
          </ul>
        </div>
        <p>Copyright &copy; Design &amp; Developed by <a href="http://www.themefisher.com">Themefisher</a>. All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>


    </body>
</html>
